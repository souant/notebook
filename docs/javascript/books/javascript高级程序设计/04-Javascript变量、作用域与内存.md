---
lang: zh-CN
title: 04-Javascript变量、作用域与内存
description: 04-Javascript变量、作用域与内存
---

# 变量、作用域与内存

javascript 变量是松散类型的，可以存储任意 js 类型，也即**弱类型**

变量值分为两种，**原始值**与**引用值**，原始值即 js 的 7 种基础类型的值

- 原始值存在栈内存中
- 引用值存在堆内存中
  * 引用值变量，在内存中存的是该对象的内存指针（内存地址）

## 执行上下文与作用域

1. 全局上下文
2. 函数上下文
3. 块级上下文

- **变量对象**（variable object）每个上下文都有一个关联的变量对象，而这个上下文中定义的所有变量和函数都存在于这个对象上, **无法通过代码访问**

- **作用域链**（scope chain）。这个作用域链决定了各级上下文中的代码在访问变量和函数时的顺序，**声明时确定**

- **this 指针** ，可以简单的理解 this 为调用函数的对象(不准确)，

    具体 this 指向 请看这篇文章分析：[JavaScript 深入之从 ECMAScript 规范解读 this](https://github.com/mqyqingfeng/Blog/issues/7)

函数执行上下文包括三个重要的元素：

- 变量对象（Variable Object，VO）：包含了函数内部的变量和函数声明，一般用活动对象(activation object, AO)来表示变量对象。
- 作用域链（Scope Chain）：用于解决变量访问的问题，它是一个由多个执行上下文的变量对象组成的链式结构。
- this 指针：指向函数被调用时的当前对象。

### 块级作用域

在使用 `var` 声明变量时，变量会被自动添加到最接近的上下文

`let` 关键字跟 `var` 很相似，但它的作用域是块级的，这也是 JavaScript 中的新概念。块
级作用域由最近的一对包含花括号{}界定

`const` 声明的变量需要在一开始就被初始化

但是 Object 对象类型的值可以被改变，可以用 Object.freeze(object)初始化对象，这样对象的值就不会被改变

:::tip
代码执行流每进入一个新上下文，都会创建一个作用域链，用于搜索变量和函数
:::

## js 内存回收

javascript 执行引擎会自动的内存管理，实现内存分配或资源回收

资源回收：变量不再被使用，周期性自动执行

内存垃圾回收策略：

1. 标记清理
   - 离开作用域的值会被自动标记为可回收，然后在垃圾回收期间被删除 
   - 主流的垃圾回收算法是标记清理，即先给当前不使用的值加上标记，再回来回收它们的内存
2. 引用计数
   - 引用计数是另一种垃圾回收策略，需要记录值被引用了多少次。JavaScript 引擎不再使用这种算法 
   - 引用计数在代码中存在循环引用时会出现问题。
